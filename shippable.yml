build:
  pre_ci_boot:
    image_name: svamann/mubench-ci
    image_tag: dev
    pull: true

language: python

before_script:
  - mkdir -p shippable/testresults

script: 
  # mubench.cli
  - mvn verify -f mubench.cli/pom.xml
  
  # mubench.utils
  - mvn verify -f mubench.utils/pom.xml
  
  # mubench.pipeline
  - nosetests -w mubench.pipeline --with-xunit --xunit-file=shippable/testresults/nosetests.xml
  - cp mubench.cli/target/DemoDetector.jar detectors/DemoDetector/DemoDetector.jar
  - python ./mubench.pipeline/benchmark.py run ex1 DemoDetector --only synthetic_survey
  
  # mubench.reviewsite
  - cd mubench.reviewsite
  - ./configure.sh
  - java -jar /usr/local/bin/selenium-server-standalone-3.12.0.jar &> selenium.log &
  - php -S localhost:8080 -t /mubench/mubench.reviewsite &> server.log &
  - phpunit --bootstrap vendor/autoload.php tests/

on_failure:
  - cat /mubench/mubench.reviewsite/selenium.log
  - cat /mubench/mubench.reviewsite/server.log

notifications:
  email:
    - mattis.kaemmerer@gmx.de
    - amann@cs.tu-darmstadt.de
    - jonas.schlitzer@googlemail.com
